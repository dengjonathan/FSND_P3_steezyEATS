
{% extends "base.html" %}

{% block head %}
{{ super() }}
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js">
    </script>
    <script src="https://apis.google.com/js/client:platform.js?onload=start"></script>
    </script>
{% endblock %}

{% block page_content %}
{{ super() }}
  <div id='signinButton'>
    <span class ='g-signin'
    data-scope ='openid email'
    data-clientid = '970011984871-5queqe9v961nepbh0p9algjim8iuutl2.apps.googleusercontent.com'
    data-redirecturi='postmessage'
    data-accesstype ='offline'
    data-cookiepolicy='single_host_origin'
    data-callback='signInCallback'
    data-approvalprompt='force'>
    </span>
  </div>

<div id = 'result'></div>
<!-- function signInCallback() will do things once you click the signinbutton -->
<script>
function signInCallback(authResult) {
  //takes in callback object sent from the google server
  //if it contains an key:value called 'code', means sign in was successful.
  if (authResult['code']){
    //hide sign-in button
    $('#signinButton').attr('style', 'display: none');
    //send callback to ajax API
    $.ajax({
      type: 'POST',
      //requires correct STATE variable (stored in .py file as global to return call back
      url: '/gconnect?state={{STATE}}',
      processDAta: false,
      contentType: 'application/octet-stream; charset=utf-8',
      //send one-time use code to server.
      data: authResult['code'],
      //return result in result div if successful callback
      success: function(result){
        if (result){
          $('#result').html('Login Successful' + result + '</br> Redirecting...')
          setTimeout(function(){
            window.location.href = '/home';
          }, 1000);
        } else if (authResult['error']) {
          console.log('There was an error' + authResult['error']);

        } else {
          $('#result').html('Failed to make connection');
        }
          }

      });
    }
  }
</script>

{% endblock %}
